{% extends "admin/change_form.html" %}  
  
{% block extrahead %}  
<script src="{{ STATIC_URL }}memory/plugins/jquery-1.7.2.min.js"></script>
<script src="{{ STATIC_URL }}memory/plugins/jquery.hope12580.plugins.min.js"></script>
<script src="{{ STATIC_URL }}bootstrap/js/bootstrap.min.js"></script>
<script src="{{ STATIC_URL }}memory/js/base.js"></script>
<script type="text/javascript">  
$(function(){

	function tips_item(){
		tips = $("#id_is_tips").val();
        url = '{% url admin_tile_change_form %}';
        if(tips == 0){
		$("#lookup_id_user").parent().find("p").text("瓦片所属用户（跟班级必选其一，不可两者同时存在，适用于教师发布瓦片范围控制）")
		}else{
			$("#lookup_id_user").parent().find("p").text("瓦片所属用户（跟班级一起为空表示所有用户，适用于后台推广的瓦片范围控制）")
		}

        $.post(url,{is_tips:tips},function(result){
        	date = $.parseJSON(result); 
        	
		    $("#id_category").empty()
		    for(var i=0;i<date.length;i++){
		    	if(date[i].parent_id == 0){
		    		$("#id_category").append('<optgroup rel="'+ i +'" label="'+ date[i].name +'">')
		    		for(var j=0;j<date.length;j++){
		    			if(date[j].parent_id == date[i].id)
		    			$("#id_category").find('optgroup[rel='+i+']').append('<option value="' + date[j].id + '">' + date[j].name + '</option>')	
		    		}	
		    	}
		    }  
		});		
        return false;
	}

	//tips_item();

    $("#id_is_tips").change(function(){
    	tips_item();
    })


    $("#tile_form").submit(function(e){
    	is_tips = $("#id_is_tips").val();
    	if(is_tips == 0){
    		group = $("#id_group").val();
    		user = $("#id_user").val();
    		if((group && !user) || (!group && user) ){
    			return true;
    		}else{
    			$("#tile_form fieldset").eq(0).before('<p class="errornote">请修正下面的错误。</p>')
    			$("#id_group, #id_user").parent().parent().parent().addClass("grp-errors")
    			e.preventDefault();
    		}
    	}
  	});
})
</script>  
{% endblock %}  